name: "Deploy Assista"

on:
 push:
  tags: 
    - "assista-planer/v*"

env: 
 PROJECT_PATH: Assistaplanner/Assistaplanner.csproj

jobs:
  deploy:
    runs-on: windows-latest
    steps: 
      - uses: actions/checkout@v2

      - uses: actions/setup-dotnet@v1
        with: 
          dotnet-version: 3.1.x

       

      - name: Install Dependencies
        run: dotnet restore ${( env.PROJECT_PATH )} 
       
      - name: Install Dapper NuGetPackage
        run: dotnet add Assistaplanner.sln package Dapper --version 2.0.90

      - name: Install SQLite NuGetPackage
        run: cd Assistaplanner.sln && dotnet add package SQLite --version 3.13.0+

      - name: Build
        run: dotnet build ${( env.PROJECT_PATH )} -c Release --no-restore 

      - name: Publish
        run: dotnet publish ${( env.PROJECT_PATH )} -c Release --self-contained -r win-x64 -p:PublishSingleFile